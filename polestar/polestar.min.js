function Polestar(q){var u=this;u.preferences=f(q,{branch:"master",cache:true,draft:"",into:"",loadAll:false,plugins:[],repo:""});u.container=false;u.articlesMetaData=[];u.articlesETag=false;u.articles=[];u.partials=[];u.pageHeight=0;u.viewportHeight=0;u.locationHashTarget=false;u.debugParameters={};u.messages={error:"Something just went horribly wrong",gitHubError:"There was a problem with the GitHub response. Perhaps the rate limit was reached (try with credentials) or a local draft or partial couldn\u2019t be read (check files and paths)."};function x(){if(document.readyState==="complete"){a()}else{document.addEventListener("DOMContentLoaded",function(){a()},false)}}function a(){i();m();if(typeof window.sessionStorage!=="undefined"){u.articlesETag=sessionStorage.getItem("etag")}if(u.preferences.draft){g()}if(!u.preferences.cache||!y()){n()}if(u.preferences.repo){b();window.onscroll=function(z){if(window.pageYOffset!==undefined){var A=window.pageYOffset}else{var A=(document.documentElement||document.body.parentNode||document.body).scrollTop}if(A===u.pageHeight-u.viewportHeight){t()}}}}function m(){if(location.hash&&location.hash.charAt(1)==="!"){var A=location.hash.substr(2).split("&");for(var z=0;z<A.length;++z){parameter=decodeURI(A[z]);if(parameter.indexOf("=")===-1){u.debugParameters[parameter.trim()]=true}else{var B=parameter.split("=");u.debugParameters[B[0].trim()]=B[1].trim()}}}}function k(A){var z=document.createElement("div");var B=document.createElement("h1");var C=document.createElement("p");z.setAttribute("class","error");z.appendChild(B);z.appendChild(C);B.appendChild(document.createTextNode(u.messages.error));C.appendChild(document.createTextNode(A));document.body.appendChild(z)}function e(){if(location.hash){var B=location.hash.substr(1,location.hash.length-1);for(var A=0;A<u.articlesMetaData.length;++A){var z=u.articlesMetaData[A].name;var C=z.substr(0,z.lastIndexOf("."))||z;if(B===C){u.locationHashTarget=B;break}}}}function c(){u.viewportHeight=document.documentElement.clientHeight;u.pageHeight=Math.max(document.documentElement.clientHeight,document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight)}function f(D,C){for(var B in D){var A=C.hasOwnProperty(B);var z=D.hasOwnProperty(B);if(A&&z){C[B]=D[B]}}return C}function j(z,A){if(u.debugParameters.hasOwnProperty("debug")){console.log("<"+z+"> "+A)}}function p(z,C){var A=new XMLHttpRequest();A.open("GET",z.url,true);if(z.hasOwnProperty("headers")){for(var B in z.headers){A.setRequestHeader(B,z.headers[B])}}if(z.url.match(/^https:\/\/api.github.com/)){v(A)}A.onreadystatechange=function(){if(A.readyState===4){if(A.getResponseHeader("X-RateLimit-Remaining")){j("Polestar#getURL","You can make another "+A.getResponseHeader("X-RateLimit-Remaining")+" GitHub API requests within the rate limit. If you are using your credentials, it should be plenty.")}if(A.status===200){C({body:A.responseText,headers:{ETag:A.getResponseHeader("ETag")}})}else{if(A.status===304){C(false)}else{j("Polestar#getURL","Hey, I got status code "+A.status+" from URL '"+z.url+"'.");k(u.messages.gitHubError);C(false)}}}};A.send(null)}function d(z,B){var A=new XMLHttpRequest();A.open("POST","https://api.github.com/markdown/raw",true);A.setRequestHeader("Content-Type","text/x-markdown");v(A);A.onreadystatechange=function(){if(A.readyState===4){if(A.status===200){B(A.responseText)}else{B(false)}}};A.send(z)}function v(A){if(u.debugParameters.hasOwnProperty("username")&&u.debugParameters.hasOwnProperty("password")){var B=u.debugParameters.username;var z=u.debugParameters.password;A.setRequestHeader("Authorization","Basic "+btoa(B+":"+z))}}function h(A,B){var z={url:A,headers:{Accept:"application/vnd.github.v3.raw"}};p(z,function(C){d(C.body,function(D){if(D){B(D)}else{k(u.messages.gitHubError)}})})}function i(){u.container=document.querySelector(u.preferences.into)||document.body}function b(){var D=u.preferences.repo.split("/");var C=D.slice(0,2).join("/");var B=(D.length>2?"/"+D.slice(2).join("/"):"");var A="https://api.github.com/repos/"+C+"/contents"+B+"?ref="+u.preferences.branch;var z={url:A};if(u.preferences.cache&&u.articlesETag){z.headers={"If-None-Match":u.articlesETag}}p(z,function(E){if(E===false){l()}else{u.articlesETag=E.headers.ETag;u.articlesMetaData=JSON.parse(E.body).filter(function(F){return F.type==="file"}).reverse();e();t()}})}function t(){if(u.articles.length<u.articlesMetaData.length){var z=u.articles.length;var A=u.articlesMetaData[z].url;var B=u.articlesMetaData[z].name;var C=B.substr(0,B.lastIndexOf("."))||B;h(A,function(F){var D=z+1>=u.articlesMetaData.length;var E=C===u.locationHashTarget;var G={content:F,id:C};if(!u.articles[z]){u.articles[z]=G;r("beforeRender",G);o(G);r("afterRender",G)}if((D&&!u.locationHashTarget)||E){w()}if(!D&&(u.preferences.loadAll||!E)){t()}s()})}}function o(A){var z=document.createElement("article");var B=document.createElement("div");B.innerHTML=A.content;z.appendChild(B);z.setAttribute("id",A.id);A.element=z;u.container.appendChild(z);c()}function n(){var C=document.querySelectorAll("*[data-at]");for(var B=0;B<C.length;++B){var A=C[B];var z=A.getAttribute("data-at");var D=A.getAttribute("id");!(function(F,E,G){p({url:E+".md"},function(H){d(H.body,function(J){var I={at:E,content:J,element:F,id:G};u.partials.push(I);r("beforeRender",I);F.innerHTML=I.content;r("afterRender",I);s()})})}(A,z,(D?D:A.getAttribute("data-at"))))}}function l(){if(typeof window.sessionStorage!=="undefined"){u.articles=JSON.parse(sessionStorage.getItem("articles"));for(var z=0;z<u.articles.length;++z){var A=u.articles[z];r("beforeRender",A);o(A);r("afterRender",A)}}}function y(){var C=document.querySelectorAll("*[data-at]").length;if(C&&typeof window.sessionStorage!=="undefined"){u.partials=JSON.parse(sessionStorage.getItem("partials"))||[];for(var B=0;B<u.partials.length;++B){var z=u.partials[B];var A=document.querySelector('*[data-at="'+z.at+'"]');if(z&&A){r("beforeRender",z);A.innerHTML=z.content;z.element=A;r("afterRender",z)}}}return u.partials.length===C}function g(){if(u.preferences.draft){var z=u.preferences.draft;var A=z.split("/")[z.split("/").length-1];p({url:z+".md"},function(B){d(B.body,function(D){if(D){var C=document.createElement("article");var F=document.createElement("div");var E={at:z,content:D,element:C,id:A};r("beforeRender",E);F.innerHTML=E.content;C.appendChild(F);C.setAttribute("id",E.id);E.element=C;if(u.articles.length){u.container.insertBefore(C,u.articles[u.articles.length-1].element)}else{u.container.appendChild(C)}r("afterRender",E)}})})}}function s(){if(u.preferences.cache&&typeof window.sessionStorage!=="undefined"){sessionStorage.setItem("etag",u.articlesETag);sessionStorage.setItem("meta",JSON.stringify(u.articlesMetaData));sessionStorage.setItem("articles",JSON.stringify(u.articles.map(function(z){z.element=false;return z})));sessionStorage.setItem("partials",JSON.stringify(u.partials.map(function(z){z.element=false;return z})))}}function r(E,D){if(u.preferences.plugins){for(var z=0;z<u.preferences.plugins.length;++z){var B=u.preferences.plugins[z];var A=B.hasOwnProperty(E);var C=typeof B[E]==="function";if(A&&C){B[E].call(D)}}}}function w(){if(window.location.hash){window.location.hash=window.location.hash}}x()};