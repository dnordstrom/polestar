function Polestar(j){var A=this;var x=f(j,{branch:"master",cache:true,draft:"",into:"",loadAll:false,plugins:[],repo:""});var w=false;var l=[];var n=false;var a=[];var o=[];var s=0;var e=0;var h=false;var v={};var E={error:"Something just went horribly wrong",gitHubError:"There was a problem with the GitHub response. Perhaps the rate limit was reached (try with credentials) or a local draft or partial couldn\u2019t be read (check files and paths)."};function D(){if(document.readyState==="complete"){b()}else{document.addEventListener("DOMContentLoaded",function(){b()},false)}}function b(){k();r();if(window.sessionStorage){n=sessionStorage.getItem("etag")}if(x.draft){i()}A.runPlugins("beforeAll");if(!x.cache||!F()){t()}if(x.repo){c();window.onscroll=function(G){if(window.pageYOffset!==undefined){var H=window.pageYOffset}else{var H=(document.documentElement||document.body.parentNode||document.body).scrollTop}if(H===s-e){z()}}}}function r(){if(location.hash&&location.hash.charAt(1)==="!"){var H=location.hash.substr(2).split("&");for(var G=0;G<H.length;++G){parameter=decodeURI(H[G]);if(parameter.indexOf("=")===-1){v[parameter.trim()]=true}else{var I=parameter.split("=");v[I[0].trim()]=I[1].trim()}}}}function p(H){var G=document.createElement("div");var I=document.createElement("h1");var J=document.createElement("p");G.setAttribute("class","error");G.appendChild(I);G.appendChild(J);I.appendChild(document.createTextNode(E.error));J.appendChild(document.createTextNode(H));document.body.appendChild(G)}function g(){if(location.hash){var I=location.hash.substr(1,location.hash.length-1);for(var H=0;H<l.length;++H){var G=l[H].name;var J=G.substr(0,G.lastIndexOf("."))||G;if(I===J){h=I;break}}}}function d(){e=document.documentElement.clientHeight;s=Math.max(document.documentElement.clientHeight,document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight)}function f(K,J){for(var I in K){var H=J.hasOwnProperty(I);var G=K.hasOwnProperty(I);if(H&&G){J[I]=K[I]}}return J}function m(G,H){if(v.hasOwnProperty("debug")){console.log("<"+G+"> "+H)}}A.getURL=function(G,J){var H=new XMLHttpRequest();H.open("GET",G.url,true);if(G.hasOwnProperty("headers")){for(var I in G.headers){H.setRequestHeader(I,G.headers[I])}}if(G.url.match(/^https:\/\/api.github.com/)){B(H)}H.onreadystatechange=function(){if(H.readyState===4){if(H.getResponseHeader("X-RateLimit-Remaining")){m("Polestar#getURL","You can make another "+H.getResponseHeader("X-RateLimit-Remaining")+" GitHub API requests within the rate limit. If you are using your credentials, it should be plenty.")}if(H.status===200){J({body:H.responseText,headers:{ETag:H.getResponseHeader("ETag")}})}else{if(H.status===304){J(false)}else{m("Polestar#getURL","Hey, I got status code "+H.status+" from URL '"+G.url+"'.");p(E.gitHubError);J(false)}}}};H.send(null)};A.parseMarkdown=function(G,I){var H=new XMLHttpRequest();H.open("POST","https://api.github.com/markdown/raw",true);H.setRequestHeader("Content-Type","text/x-markdown");B(H);H.onreadystatechange=function(){if(H.readyState===4){if(H.status===200){I(H.responseText)}else{p(E.gitHubError);I(false)}}};H.send(G)};function B(H){if(v.hasOwnProperty("username")&&v.hasOwnProperty("password")){var I=v.username;var G=v.password;H.setRequestHeader("Authorization","Basic "+btoa(I+":"+G))}}function k(){w=document.querySelector(x.into)||document.body}function c(){var K=x.repo.split("/");var J=K.slice(0,2).join("/");var I=(K.length>2?"/"+K.slice(2).join("/"):"");var H="https://api.github.com/repos/"+J+"/contents"+I+"?ref="+x.branch;var G={url:H};if(x.cache&&n){G.headers={"If-None-Match":n}}A.getURL(G,function(L){if(L===false){q()}else{n=L.headers.ETag;l=JSON.parse(L.body).filter(function(M){return M.type==="file"}).reverse();g();z()}})}function z(){if(a.length<l.length){var G=a.length;var I=l[G].url;var J=l[G].name;var K=J.substr(0,J.lastIndexOf("."))||J;var H={url:I,headers:{Accept:"application/vnd.github.v3.raw"}};A.getURL(H,function(L){A.parseMarkdown(L.body,function(O){var M=G+1>=l.length;var N=K===h;var P={content:O,id:K};if(!a[G]){a[G]=P;A.runPlugins("beforeRender",P);u(P);A.runPlugins("afterRender",P)}if((M&&!h)||N){C()}if(!M&&(x.loadAll||!N)){z()}y()})})}}function u(H){var G=document.createElement("article");var I=document.createElement("div");I.innerHTML=H.content;G.appendChild(I);G.setAttribute("id",H.id);H.element=G;w.appendChild(G);d()}function t(){var J=document.querySelectorAll("*[data-at]");for(var I=0;I<J.length;++I){var H=J[I];var G=H.getAttribute("data-at");var K=H.getAttribute("id");!(function(M,L,N){A.getURL({url:L+".md"},function(O){A.parseMarkdown(O.body,function(Q){var P={at:L,content:Q,element:M,id:N};o.push(P);A.runPlugins("beforeRender",P);M.innerHTML=P.content;A.runPlugins("afterRender",P);y()})})}(H,G,(K?K:H.getAttribute("data-at"))))}}function q(){if(typeof window.sessionStorage!=="undefined"){a=JSON.parse(sessionStorage.getItem("articles"));for(var G=0;G<a.length;++G){var H=a[G];A.runPlugins("beforeRender",H);u(H);A.runPlugins("afterRender",H)}}}function F(){var J=document.querySelectorAll("*[data-at]").length;if(J&&window.sessionStorage){o=JSON.parse(sessionStorage.getItem("partials"))||[];for(var I=0;I<o.length;++I){var G=o[I];var H=document.querySelector('*[data-at="'+G.at+'"]');if(G&&H){A.runPlugins("beforeRender",G);H.innerHTML=G.content;G.element=H;A.runPlugins("afterRender",G)}}}return o.length===J}function i(){if(x.draft){var G=x.draft;var H=G.split("/")[G.split("/").length-1];A.getURL({url:G+".md"},function(I){A.parseMarkdown(I.body,function(K){if(K){var J=document.createElement("article");var M=document.createElement("div");var L={at:G,content:K,element:J,id:H};A.runPlugins("beforeRender",L);M.innerHTML=L.content;J.appendChild(M);J.setAttribute("id",L.id);L.element=J;if(a.length){w.insertBefore(J,a[a.length-1].element)}else{w.appendChild(J)}A.runPlugins("afterRender",L)}})})}}function y(){if(x.cache&&window.sessionStorage){sessionStorage.setItem("etag",n);sessionStorage.setItem("meta",JSON.stringify(l));sessionStorage.setItem("articles",JSON.stringify(a.map(function(G){G.element=false;return G})));sessionStorage.setItem("partials",JSON.stringify(o.map(function(G){G.element=false;return G})))}}A.runPlugins=function(L,H){if(x.plugins){for(var G=0;G<x.plugins.length;++G){var K=x.plugins[G];var I=K.hasOwnProperty(L);var J=typeof K[L]==="function";if(I&&J){H?K[L](A,H):K[L](A)}}}};function C(){if(location.hash){location.hash=location.hash}}D()};